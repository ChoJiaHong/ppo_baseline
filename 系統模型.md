# 系統模型

## 1. 實體基礎集合
1. **Edge Nodes** $N_{set} = \{N_1, N_2, ..,N_i, ..,N_n\}$：有n個節點，每個節點硬體資源不一定相同。
2. **Service Types** $T_{set} = \{T_1, T_2, .., T_j,..T_m\}$：有m種不同類型的服務。
3. **Agents** $A_{set} = \{A_1, A_2,.., A_k..,A_p\}$：有p個使用者

每個 Agent $A_k$ 需要一組服務：$R(A_k) \subseteq T_{set}$

| Agent | 所需服務集合 $R(A_k)$ |
| :---: | :-------------------: |
| $A_1$ | $\{T_1,T_2\}$ |
| $A_2$ | $\{T_1,T_2,T_3\}$ |
| $A_3$ | $\{T_2,T_3\}$ |
| $A_4$ | $\{T_1\}$ |

---

## 2. 部署組合概念
忽略硬體限制時，對於任一節點可討論「可能部署的服務組合」。  
所有「服務部署組合」的全集為 $2^{T_{set}}$。  
任一組合記為 $c \subseteq T_{set}$。此階段尚不判斷可行性。

---

## 3. 硬體資源與離線量測流程
節點 $N_i$ 具有有限硬體資源（CPU / RAM / VRAM 等），因此實際可部署組合並不為全集 $2^{T_{set}}$。

離線量測的目的：針對每個候選部署組合 $c$，實際在節點 $N_i$ 上部署並壓測，量得該組合中每個服務 $T_j$ 的穩定吞吐量上限 $W(i,c,j)$。

在量測過程中，部分組合可能因資源衝突、啟動失敗或效能不穩定而無法成功部署。這些「部署失敗」或「不穩定」的組合將被排除，不納入可行部署組合集合 $C_i$。只有那些實際部署成功且吞吐量穩定的組合，才會被收錄於 $C_i$，並記錄其對應的 $W(i,c,j)$。

#### 因此，模型後續所有可部署組合 $C_i$ 及其吞吐量 $W(i,c,j)$，皆以離線量測結果為依據。
## 4. 服務吞吐量表 
$W(i,c,j)$ 為離線壓測量測結果；若某組合在量測中部署失敗或吞吐不穩定，則不收錄（視為不可用）。

| 節點 | 部署組合 $c$ | 服務 $T_j$ | 吞吐量上限 $W(i,c,j)$ |
| :--: | :----------- | :--------: | :--------------------: |
| N₁ | {T₁} | T₁ | 100 |
| N₁ | {T₂} | T₂ | 220 |
| N₁ | {T₃} | T₃ | 90 |
| N₁ | {T₁,T₂} | T₁ | 58 |
| N₁ | {T₁,T₂} | T₂ | 127 |
| N₁ | {T₁,T₃} | T₁ | 58 |
| N₁ | {T₁,T₃} | T₃ | 52 |
| N₂ | {T₁} | T₁ | 130 |
| N₂ | {T₂} | T₂ | 260 |
| N₂ | {T₃} | T₃ | 110 |
| N₂ | {T₁,T₂} | T₁ | 75 |
| N₂ | {T₁,T₂} | T₂ | 150 |
| N₂ | {T₁,T₃} | T₁ | 75 |
| N₂ | {T₁,T₃} | T₃ | 63 |
| N₂ | {T₂,T₃} | T₂ | 150 |
| N₂ | {T₂,T₃} | T₃ | 63 |
| N₂ | {T₁,T₂,T₃} | T₁ | 56 |
| N₂ | {T₁,T₂,T₃} | T₂ | 113 |
| N₂ | {T₁,T₂,T₃} | T₃ | 48 |
| N₃ | {T₂} | T₂ | 190 |
| N₃ | {T₃} | T₃ | 75 |
| N₃ | {T₂,T₃} | T₂ | 109 |
| N₃ | {T₂,T₃} | T₃ | 43 |

備註：模型中容量約束直接使用量測值 $W(i,d_i,j)$。

---

## 5. 可部署組合集合定義
針對節點 $N_i$，可行部署組合集合由離線量測直接決定：
$$
C_i = \{\, c \subseteq T_{set} \mid \forall j \in c,\; W(i,c,j)\ \text{已離線量測且穩定} \,\}
$$

系統中真正「可被選擇」的部署組合僅來自 $C_i$。  
執行時節點選定一個實際運行組合：
$$
d_i \in C_i
$$

| 節點 ($N_i$) | 實際部署組合 ($d_i$) |
| :--: | :--: |
| $N_1$ | $\{T_1,T_2,T_3\}$ |
| $N_2$ | $\{T_2,T_3\}$ |
| $N_3$ | $\{T_3\}$ |

---

## 6. 服務回傳頻率範圍
此處的 $f_j^{l}, f_j^{h}$ 為「單一 Agent 對服務 $T_j$ 在穩態可獲得的回傳頻率範圍」的界定參數。  
對每個需要服務 $T_j$ 的 Agent $A_k$，其**預期回傳頻率**定義為
$$
\sum_{i \in N_{set}} x_{i,j,k}
$$
應滿足以下條件：
- **品質達成判準（最低 QoS）**：$\sum_{i} x_{i,j,k} \ge f_j^{l}$  
  若低於此值，使用者可能出現明顯體感下降（如延遲感、頭暈、操作失誤增加），任務完成率顯著劣化，視為 QoS 不合格。
- **過度分配上限**：$\sum_{i} x_{i,j,k} \le f_j^{h}$  
  超過此值對使用者體驗與任務成功率提升趨於飽和，再提高只會造成系統資源浪費與排擠其他使用者，因此設置為上限。

與節點層級吞吐量 $W(i,d_i,j)$ 差異如下：
- $W(i,d_i,j)$：同一節點在部署組合 $d_i$ 下，所有 Agents 對該服務的「總合」頻率上限（aggregate capacity）。
- $f_j^{l}, f_j^{h}$：針對「單一 Agent」與服務的需求品質區間（per-agent QoS range）。

| 服務 | 最低頻率 (保證門檻) $f_j^{l}$ | 標準上限 (飽和值) $f_j^{h}$ |
| :--: | :--: | :--: |
| $T_1$ | 10 | 20 |
| $T_2$ | 20 | 40 |
| $T_3$ | 15 | 30 |

補充說明：
- 最低頻率 $f_j^{l}$：低於此值時使用者會出現明顯體感下降（例如延遲感、頭暈、操作失誤增加），任務完成率顯著劣化，視為 QoS 不合格。
- 標準上限 $f_j^{h}$：超過此值對使用者體驗與任務成功率提升趨於飽和；再提高只會佔用系統資源造成浪費與排擠其他使用者，設置為上限

---

## 7. 連線與分配變數
每個 Agent 會與部署了對應服務的節點建立連線。  
定義變數 $x_{i,j,k}$：

$$
x_{i,j,k} \in \mathbb{Z}_{\ge 0}
$$



定義 $x_{i,j,k} \in \mathbb{Z}_{\ge 0}$ 為 Agent $A_k$ 分配到節點 $N_i$ 上服務 $T_j$ 的請求頻率；
### Agent 使用限制（同一服務僅選一個節點）：
$$
\left| \{ i \in N_{set} \mid x_{i,j,k} > 0 \} \right| \le 1 \quad \forall k\in A_{set},\ \forall j\in R(A_k)
$$


---

## 8. 資源與需求約束
### (1) 節點資源約束

每個節點在其選定部署組合 $d_i$ 下，服務 $T_j$ 的總分配頻率不得超過量測之吞吐量上限；若 $T_j \notin d_i$ 則視為上限為 0：
$$
\sum_{k\in A_{set}} x_{i,j,k} \le W(i,d_i,j),\quad \forall i \in N_{set},\ \forall j \in T_{set}
$$

### (2) 服務需求約束
每個 Agent $A_k$ 被分配的頻率不得超過服務 $T_j$ 的標準頻率：
$$
\sum_{i \in N_{set}} x_{i,j,k} \le f_j^{h}, \quad \forall k \in A_{set},\ \forall j \in R(A_k)
$$

---

## 9. 動態調整問題
當 $N_{set}$ 或 $A_{set}$ 變動（故障/恢復/增刪），在限時內重新決策：
- 調整 $x_{i,j,k}$ , $d_i$
---

## 10. 最佳化目標 (兩層)
第一層：最大化達成最低 QoS 之 Agent 數：
$$
\max \sum_{k} \prod_{j \in R(A_k)} y_{k,j},\quad
y_{k,j} = \begin{cases}
1,& \sum_i x_{k,i,j} \ge f_j^{l}\\
0,& \text{else}
\end{cases}
$$

若多組解同樣人數，再比較：
$$
\max \sum_{k}\sum_{j \in R(A_k)} \frac{\sum_i x_{k,i,j}}{f_j^{h}}
$$




---

## 11. 符號總表
| 符號 | 說明 |
|------|------|
| $N_{set}$ | 邊緣節點集合 |
| $T_{set}$ | 服務集合 |
| $A_{set}$ | Agent 集合 |
| $R(A_k)$ | Agent $A_k$ 所需服務集合 |
| $c$ | 抽象服務部署組合（元素為服務子集合） |
| $C_i$ | 節點 $N_i$ 之可行部署組合集合（由離線量測確認） |
| $d_i$ | 節點 $N_i$ 實際選定的部署組合（$d_i \in C_i$） |
| $u_j$ | 服務 $T_j$ 的資源需求（可為向量） |
| $W(i,c,j)$ | 節點 $i$ 在部署組合 $c$ 下服務 $j$ 的總吞吐量上限（離線量測外生輸入） |
| $x_{i,j,k}$ | Agent $A_k$ 分配在節點 $N_i$ 的服務 $T_j$ 請求頻率 |
| $f_j^{l}$ | 單一 Agent 對服務 $T_j$ 最低可接受頻率（QoS 下限） |
| $f_j^{h}$ | 單一 Agent 對服務 $T_j$ 的飽和值（不再增加效益的上限） |
| $y_{k,j}$ | 服務 $T_j$ 對 Agent 是否達成最低頻率（指示變數） |

